
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Planner Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }
        
        .header-title {
            display: flex;
            flex-direction: column;
        }
        
        .header-title h1 {
            font-size: 24px;
            color: #333;
            font-weight: 700;
        }
        
        .header-title p {
            font-size: 13px;
            color: #777;
            margin-top: 2px;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #eb3349, #f45c43);
            color: white;
        }
        
        /* Date Navigation */
        .date-nav {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .date-display {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }
        
        .date-input {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            min-width: 180px;
        }
        
        .date-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .nav-arrows {
            display: flex;
            gap: 10px;
        }
        
        .nav-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: #f5f5f5;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #667eea;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }
        
        /* Main Content */
        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .section-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: #333;
        }
        
        /* Time Blocking */
        .time-table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 2px solid #f0f0f0;
        }
        
        .time-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .time-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 8px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .time-table th.task-header {
            min-width: 80px;
            text-align: left;
            padding-left: 15px;
        }
        
        .time-table td {
            border: 1px solid #e0e0e0;
            padding: 0;
            height: 35px;
        }
        
        .time-table td.task-cell {
            background: #f8f9fa;
            font-weight: 600;
            color: #667eea;
            padding: 8px 15px;
            font-size: 13px;
        }
        
        .time-table td.time-cell {
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .time-table td.time-cell:hover {
            background: #f0f0ff;
        }
        
        .time-table td.time-cell.filled {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        /* Grid Layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-group label {
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group textarea {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        /* Priority List */
        .priority-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .priority-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .priority-number {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .priority-item input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 15px;
            font-weight: 500;
            color: #333;
            padding: 8px;
        }
        
        .priority-item input:focus {
            outline: none;
            background: white;
            border-radius: 5px;
        }
        
        /* History Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            padding: 25px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }
        
        .close-modal {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: #f5f5f5;
            cursor: pointer;
            font-size: 24px;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            background: #eb3349;
            color: white;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .history-item {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
        }
        
        .history-item:hover {
            background: #e8e9ff;
            transform: translateX(5px);
        }
        
        .history-date {
            font-weight: 700;
            font-size: 18px;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .history-preview {
            font-size: 14px;
            color: #666;
        }
        
        /* Status Badge */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: auto;
        }
        
        .status-saved {
            background: #d4edda;
            color: #155724;
        }
        
        .status-saving {
            background: #fff3cd;
            color: #856404;
        }
        
        /* Loading Spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header-title h1 {
                font-size: 20px;
            }
            
            .date-nav {
                flex-direction: column;
                align-items: stretch;
            }
            
            .date-display {
                flex-direction: column;
                align-items: stretch;
            }
            
            .content {
                padding: 20px;
            }
            
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .header-actions,
            .nav-arrows,
            .btn {
                display: none !important;
            }
            
            .content {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="logo">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="header-title">
                    <h1>Daily Planner Pro</h1>
                    <p>Organize your day, track your progress</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="status-badge status-saved" id="saveStatus">
                    <i class="fas fa-check-circle"></i>
                    <span>Saved</span>
                </div>
                <button class="btn btn-secondary" onclick="viewHistory()">
                    <i class="fas fa-history"></i> History
                </button>
                <button class="btn btn-success" onclick="saveNow()">
                    <i class="fas fa-save"></i> Save Now
                </button>
                <button class="btn btn-primary" onclick="window.print()">
                    <i class="fas fa-print"></i> Print
                </button>
            </div>
        </div>
        
        <!-- Date Navigation -->
        <div class="date-nav">
            <div class="date-display">
                <input type="date" id="dateInput" class="date-input">
                <strong id="dayDisplay" style="font-size: 18px; color: #667eea;"></strong>
            </div>
            <div class="nav-arrows">
                <button class="nav-btn" onclick="changeDate(-1)" title="Previous Day">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="nav-btn" onclick="setToday()" title="Today">
                    <i class="fas fa-calendar-day"></i>
                </button>
                <button class="nav-btn" onclick="changeDate(1)" title="Next Day">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="content">
            <!-- Time Blocking -->
            <div class="section">
                <div class="section-header">
                    <div class="section-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h2 class="section-title">Time Blocking (7 AM - 10 PM)</h2>
                </div>
                <div class="time-table-container">
                    <table class="time-table">
                        <thead>
                            <tr>
                                <th class="task-header">TASK</th>
                                <th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th>
                                <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th>
                                <th>7</th><th>8</th><th>9</th><th>10</th>
                            </tr>
                        </thead>
                        <tbody id="timeTable"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Health Tracker -->
            <div class="section">
                <div class="section-header">
                    <div class="section-icon" style="background: linear-gradient(135deg, #11998e, #38ef7d);">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <h2 class="section-title">Health Tracker</h2>
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label><i class="fas fa-weight"></i> Weight</label>
                        <input type="text" id="weight" placeholder="lbs/kg">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-bed"></i> Sleep</label>
                        <input type="text" id="sleep" placeholder="hours">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-tint"></i> Water</label>
                        <input type="text" id="water" placeholder="glasses">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-running"></i> Exercise</label>
                        <input type="text" id="exercise" placeholder="minutes">
                    </div>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>Notes</label>
                    <textarea id="healthNotes" placeholder="Additional health notes..."></textarea>
                </div>
            </div>
            
            <!-- Nutrition -->
            <div class="section">
                <div class="section-header">
                    <div class="section-icon" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <h2 class="section-title">Nutrition Log</h2>
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>üç≥ Breakfast</label>
                        <input type="text" id="breakfast" placeholder="What did you eat?">
                    </div>
                    <div class="form-group">
                        <label>ü•ó Lunch</label>
                        <input type="text" id="lunch" placeholder="What did you eat?">
                    </div>
                    <div class="form-group">
                        <label>üçù Dinner</label>
                        <input type="text" id="dinner" placeholder="What did you eat?">
                    </div>
                    <div class="form-group">
                        <label>üçé Snacks</label>
                        <input type="text" id="snacks" placeholder="What did you eat?">
                    </div>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>Notes</label>
                    <textarea id="nutritionNotes" placeholder="Additional nutrition notes..."></textarea>
                </div>
            </div>
            
            <!-- Money Management -->
            <div class="section">
                <div class="section-header">
                    <div class="section-icon" style="background: linear-gradient(135deg, #ffecd2, #fcb69f);">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <h2 class="section-title">Money Management</h2>
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>üí∞ Total</label>
                        <input type="text" id="total" placeholder="$0.00">
                    </div>
                    <div class="form-group">
                        <label>üí∏ Spent</label>
                        <input type="text" id="spent" placeholder="$0.00">
                    </div>
                    <div class="form-group">
                        <label>üéÅ Spoil</label>
                        <input type="text" id="spoil" placeholder="$0.00">
                    </div>
                    <div class="form-group">
                        <label>üìà Gained</label>
                        <input type="text" id="gained" placeholder="$0.00">
                    </div>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>Notes</label>
                    <textarea id="moneyNotes" placeholder="Additional money notes..."></textarea>
                </div>
            </div>
            
            <!-- Wins & Gratitude -->
            <div class="section">
                <div class="section-header">
                    <div class="section-icon" style="background: linear-gradient(135deg, #fa709a, #fee140);">
                        <i class="fas fa-star"></i>
                    </div>
                    <h2 class="section-title">Wins & Gratitude</h2>
                </div>
                <div class="form-group">
                    <textarea id="winsGratitude" placeholder="What went well today? What are you grateful for?"></textarea>
                </div>
            </div>
            
            <!-- Tomorrow's Priorities -->
            <div class="section">
                <div class="section-header">
                    <div class="section-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                        <i class="fas fa-list-ol"></i>
                    </div>
                    <h2 class="section-title">Tomorrow's Top 3 Priorities</h2>
                </div>
                <ul class="priority-list">
                    <li class="priority-item">
                        <div class="priority-number">1</div>
                        <input type="text" id="priority1" placeholder="Most important task">
                    </li>
                    <li class="priority-item">
                        <div class="priority-number">2</div>
                        <input type="text" id="priority2" placeholder="Second priority">
                    </li>
                    <li class="priority-item">
                        <div class="priority-number">3</div>
                        <input type="text" id="priority3" placeholder="Third priority">
                    </li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- History Modal -->
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-history"></i> Your Planning History
                </h3>
                <button class="close-modal" onclick="closeHistory()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="history-list" id="historyList">
                    <p style="text-align: center; color: #999; padding: 40px 0;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 32px;"></i>
                        <br><br>Loading history...
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCL4cB6loL0XtxljIUa8Hd92Ff4mw9ftO8",
            authDomain: "eshopproject-19bb4.firebaseapp.com",
            projectId: "eshopproject-19bb4",
            storageBucket: "eshopproject-19bb4.appspot.com",
            messagingSenderId: "863268336252",
            appId: "1:863268336252:web:e90c30527cf0c56f0d4ff9"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Task abbreviations with emojis
        const tasks = [
            'üìö Study', 
            'üíª Deep Work', 
            'üìã Admin', 
            'üë• Meetings', 
            '‚òï Break Time', 
            'üçΩÔ∏è Meal Break', 
            '‚öΩ Sport/Training', 
            'üéØ Project', 
            'üí™ Workout', 
            'üì∞ NYT', 
            'üîï No Distraction', 
            'üö´ No Meeting', 
            'üè† Life/Chores', 
            'üíº Work'
        ];

        let currentDate = new Date();
        let autoSaveTimer = null;
        let scheduledSaveTimer = null;

        // Initialize
        function init() {
            initializeTimeTable();
            setToday();
            setupAutoSave();
            setupScheduledSave();
            setupEventListeners();
        }

        // Initialize Time Table
        function initializeTimeTable() {
            const tbody = document.getElementById('timeTable');
            tbody.innerHTML = '';
            
            tasks.forEach((task, idx) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="task-cell">${task}</td>
                    ${Array(16).fill(0).map((_, i) => 
                        `<td class="time-cell" data-task="${idx}" data-hour="${i}"></td>`
                    ).join('')}
                `;
                tbody.appendChild(row);
            });
            
            document.querySelectorAll('.time-cell').forEach(cell => {
                cell.addEventListener('click', function() {
                    this.classList.toggle('filled');
                    triggerAutoSave();
                });
            });
        }

        // Date Functions
        function setToday() {
            currentDate = new Date();
            updateDateDisplay();
            loadData();
        }

        function changeDate(days) {
            currentDate.setDate(currentDate.getDate() + days);
            updateDateDisplay();
            loadData();
        }

        function updateDateDisplay() {
            const dateInput = document.getElementById('dateInput');
            const dayDisplay = document.getElementById('dayDisplay');
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const day = String(currentDate.getDate()).padStart(2, '0');
            
            dateInput.value = `${year}-${month}-${day}`;
            dayDisplay.textContent = days[currentDate.getDay()];
        }
        
        // Listen to date input changes
        document.getElementById('dateInput').addEventListener('change', function() {
            const selectedDate = new Date(this.value + 'T00:00:00');
            if (!isNaN(selectedDate.getTime())) {
                currentDate = selectedDate;
                updateDateDisplay();
                loadData();
            }
        });

        // Data Functions
        function getDateKey() {
            return currentDate.toISOString().split('T')[0];
        }

        function collectData() {
            const data = {
                date: getDateKey(),
                dayOfWeek: document.getElementById('dayDisplay').textContent,
                timeBlocks: {},
                health: {
                    weight: document.getElementById('weight').value,
                    sleep: document.getElementById('sleep').value,
                    water: document.getElementById('water').value,
                    exercise: document.getElementById('exercise').value,
                    notes: document.getElementById('healthNotes').value
                },
                nutrition: {
                    breakfast: document.getElementById('breakfast').value,
                    lunch: document.getElementById('lunch').value,
                    dinner: document.getElementById('dinner').value,
                    snacks: document.getElementById('snacks').value,
                    notes: document.getElementById('nutritionNotes').value
                },
                money: {
                    total: document.getElementById('total').value,
                    spent: document.getElementById('spent').value,
                    spoil: document.getElementById('spoil').value,
                    gained: document.getElementById('gained').value,
                    notes: document.getElementById('moneyNotes').value
                },
                winsGratitude: document.getElementById('winsGratitude').value,
                priorities: {
                    priority1: document.getElementById('priority1').value,
                    priority2: document.getElementById('priority2').value,
                    priority3: document.getElementById('priority3').value
                },
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            // Collect time blocks
            document.querySelectorAll('.time-cell.filled').forEach(cell => {
                const key = `${cell.dataset.task}-${cell.dataset.hour}`;
                data.timeBlocks[key] = true;
            });
            
            return data;
        }

        function loadData() {
            const dateKey = getDateKey();
            
            // Clear current data
            clearForm();
            
            // Load from Firebase
            db.collection('dailyPlanner').doc(dateKey).get()
                .then(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        populateForm(data);
                        updateSaveStatus('saved');
                    } else {
                        updateSaveStatus('saved');
                    }
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    updateSaveStatus('saved');
                });
        }

        function clearForm() {
            // Clear all inputs
            document.querySelectorAll('input[type="text"], textarea').forEach(el => {
                el.value = '';
            });
            
            // Clear time blocks
            document.querySelectorAll('.time-cell').forEach(cell => {
                cell.classList.remove('filled');
            });
        }

        function populateForm(data) {
            // Time blocks
            if (data.timeBlocks) {
                Object.keys(data.timeBlocks).forEach(key => {
                    const [task, hour] = key.split('-');
                    const cell = document.querySelector(`.time-cell[data-task="${task}"][data-hour="${hour}"]`);
                    if (cell) cell.classList.add('filled');
                });
            }
            
            // Health
            if (data.health) {
                document.getElementById('weight').value = data.health.weight || '';
                document.getElementById('sleep').value = data.health.sleep || '';
                document.getElementById('water').value = data.health.water || '';
                document.getElementById('exercise').value = data.health.exercise || '';
                document.getElementById('healthNotes').value = data.health.notes || '';
            }
            
            // Nutrition
            if (data.nutrition) {
                document.getElementById('breakfast').value = data.nutrition.breakfast || '';
                document.getElementById('lunch').value = data.nutrition.lunch || '';
                document.getElementById('dinner').value = data.nutrition.dinner || '';
                document.getElementById('snacks').value = data.nutrition.snacks || '';
                document.getElementById('nutritionNotes').value = data.nutrition.notes || '';
            }
            
            // Money
            if (data.money) {
                document.getElementById('total').value = data.money.total || '';
                document.getElementById('spent').value = data.money.spent || '';
                document.getElementById('spoil').value = data.money.spoil || '';
                document.getElementById('gained').value = data.money.gained || '';
                document.getElementById('moneyNotes').value = data.money.notes || '';
            }
            
            // Wins & Gratitude
            document.getElementById('winsGratitude').value = data.winsGratitude || '';
            
            // Priorities
            if (data.priorities) {
                document.getElementById('priority1').value = data.priorities.priority1 || '';
                document.getElementById('priority2').value = data.priorities.priority2 || '';
                document.getElementById('priority3').value = data.priorities.priority3 || '';
            }
        }

        function saveNow() {
            const data = collectData();
            const dateKey = getDateKey();
            
            updateSaveStatus('saving');
            
            db.collection('dailyPlanner').doc(dateKey).set(data)
                .then(() => {
                    console.log('Data saved successfully');
                    updateSaveStatus('saved');
                })
                .catch(error => {
                    console.error('Error saving data:', error);
                    alert('Error saving data. Please try again.');
                    updateSaveStatus('saved');
                });
        }

        function triggerAutoSave() {
            clearTimeout(autoSaveTimer);
            updateSaveStatus('saving');
            
            autoSaveTimer = setTimeout(() => {
                saveNow();
            }, 2000); // Save after 2 seconds of inactivity
        }

        function setupAutoSave() {
            document.querySelectorAll('input, textarea').forEach(el => {
                el.addEventListener('input', triggerAutoSave);
                el.addEventListener('change', triggerAutoSave);
            });
        }

        function setupScheduledSave() {
            // Schedule daily save at 4 PM
            function scheduleNextSave() {
                const now = new Date();
                const scheduledTime = new Date();
                scheduledTime.setHours(16, 0, 0, 0); // 4 PM
                
                // If it's already past 4 PM today, schedule for tomorrow
                if (now >= scheduledTime) {
                    scheduledTime.setDate(scheduledTime.getDate() + 1);
                }
                
                const timeUntilSave = scheduledTime - now;
                
                clearTimeout(scheduledSaveTimer);
                scheduledSaveTimer = setTimeout(() => {
                    saveNow();
                    console.log('Scheduled save at 4 PM completed');
                    scheduleNextSave(); // Schedule next day's save
                }, timeUntilSave);
                
                console.log(`Next scheduled save at: ${scheduledTime.toLocaleString()}`);
            }
            
            scheduleNextSave();
        }

        function setupEventListeners() {
            // Date input change listener is already added in updateDateDisplay section
        }

        function updateSaveStatus(status) {
            const statusEl = document.getElementById('saveStatus');
            
            if (status === 'saving') {
                statusEl.className = 'status-badge status-saving';
                statusEl.innerHTML = '<div class="spinner"></div><span>Saving...</span>';
            } else {
                statusEl.className = 'status-badge status-saved';
                statusEl.innerHTML = '<i class="fas fa-check-circle"></i><span>Saved</span>';
            }
        }

        // History Functions
        function viewHistory() {
            const modal = document.getElementById('historyModal');
            const historyList = document.getElementById('historyList');
            
            modal.classList.add('active');
            historyList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px 0;"><i class="fas fa-spinner fa-spin" style="font-size: 32px;"></i><br><br>Loading history...</p>';
            
            db.collection('dailyPlanner')
                .orderBy('date', 'desc')
                .limit(30)
                .get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        historyList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px 0;"><i class="fas fa-inbox" style="font-size: 48px;"></i><br><br>No history found. Start planning to build your history!</p>';
                        return;
                    }
                    
                    historyList.innerHTML = '';
                    
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const item = document.createElement('div');
                        item.className = 'history-item';
                        
                        const date = new Date(data.date + 'T00:00:00');
                        const formattedDate = date.toLocaleDateString('en-US', { 
                            weekday: 'long', 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        });
                        
                        let preview = '';
                        if (data.priorities && data.priorities.priority1) {
                            preview = `Top Priority: ${data.priorities.priority1}`;
                        } else if (data.winsGratitude) {
                            preview = data.winsGratitude.substring(0, 60) + '...';
                        } else {
                            preview = 'Click to view details';
                        }
                        
                        item.innerHTML = `
                            <div class="history-date">${formattedDate}</div>
                            <div class="history-preview">${preview}</div>
                        `;
                        
                        item.onclick = () => {
                            currentDate = date;
                            updateDateDisplay();
                            loadData();
                            closeHistory();
                        };
                        
                        historyList.appendChild(item);
                    });
                })
                .catch(error => {
                    console.error('Error loading history:', error);
                    historyList.innerHTML = '<p style="text-align: center; color: #e74c3c; padding: 40px 0;"><i class="fas fa-exclamation-circle" style="font-size: 48px;"></i><br><br>Error loading history. Please try again.</p>';
                });
        }

        function closeHistory() {
            document.getElementById('historyModal').classList.remove('active');
        }

        // Close modal when clicking outside
        document.getElementById('historyModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeHistory();
            }
        });

        // Initialize app
        init();
    </script>
</body>
</html>
